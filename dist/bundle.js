!function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class r{constructor(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",t),this.canvas.setAttribute("height",e),this.context=this.canvas.getContext("2d"),this.gridOptions={color:"grey",gridSize:40,linesSize:0},this.occupied={},this.start={c:this.getRandomCol(),r:this.getRandomRow()},document.getElementsByTagName("body")[0].appendChild(this.canvas)}get(){return this.canvas}getRandomCol(){return Math.floor(Math.random()*(this.width/this.gridOptions.gridSize))}getColFromX(t){return Math.floor(t/this.gridOptions.gridSize)}getRowFromY(t){return Math.floor(t/this.gridOptions.gridSize)}getRandomRow(){return Math.floor(Math.random()*(this.height/this.gridOptions.gridSize))}getXFromCol(t){return t%Math.floor(this.width/this.gridOptions.gridSize)*this.gridOptions.gridSize}getYFromRow(t){return t%Math.floor(this.width/this.gridOptions.gridSize)*this.gridOptions.gridSize}drawGrid(){this.context.strokeStyle=this.gridOptions.color,this.context.lineWidth=parseInt(this.gridOptions.linesSize);let t=parseInt(this.gridOptions.gridSize);for(let e=0;e<this.height;e+=t)this.context.moveTo(0,e),this.context.lineTo(this.width,e),this.context.stroke();for(let e=0;e<this.width;e+=t)this.context.moveTo(e,0),this.context.lineTo(e,this.height),this.context.stroke()}drawPlayer(t,e){let i=document.createElement("img");i.setAttribute("src","img/person.png"),i.setAttribute("id","person"),i.onload=()=>{this.context.drawImage(i,this.getXFromCol(t),this.getYFromRow(e),this.gridOptions.gridSize,this.gridOptions.gridSize)},this.occupied[this.getKey(t,e)]="player"}drawPath(t){for(let e=0;e<t.length;e++){let i,r;[i,r]=t[e].split(","),this.context.beginPath(),this.context.arc(this.getXFromCol(i)+20,this.getYFromRow(r)+20,5,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.lineWidth=0}}getKey(t,e){return`${t},${e}`}isOccupiedByTree(t,e){return void 0!==this.occupied[this.getKey(t,e)]&&"tree"===this.occupied[this.getKey(t,e)]}drawTrees(t){for(let e=0;e<t;e++){let t=this.getRandomCol(),i=this.getRandomRow();if(void 0!==this.occupied[this.getKey(t,i)]){e-=1;continue}let r=document.createElement("img");r.setAttribute("src","img/tree.jpeg"),r.setAttribute("id","tree"),r.onload=()=>{this.context.drawImage(r,this.getXFromCol(t)+1,this.getYFromRow(i)+1,this.gridOptions.gridSize-1,this.gridOptions.gridSize-1)},this.occupied[this.getKey(t,i)]="tree"}}clearBlock(t,e){this.context.clearRect(this.getXFromCol(t)+1,this.getYFromRow(e)+1,this.gridOptions.gridSize-2,this.gridOptions.gridSize-2)}clearBlocks(t){for(let e=0;e<t.length;e++){let i=t[e].split(",");this.clearBlock(i[0],i[1])}}}class s{constructor(t){this.renderer=t}generatePath(t,e){let i={c:t.c,r:t.r},r=[i],s=!1,o=[],n={};for(n[`${i.c},${i.r}`]=!1;r.length>0;){i=r.shift();let t=[-1,1,0,0],h=[0,0,-1,1];if(e.c==i.c&&e.r==i.r){s=!0;break}for(let e=0;e<t.length;e++){let s=parseInt(i.r)+t[e],a=parseInt(i.c)+h[e];s<0||a<0||s>Math.floor(this.renderer.height/this.renderer.gridOptions.gridSize)-1||a>Math.floor(this.renderer.width/this.renderer.gridOptions.gridSize)-1||-1===o.indexOf(`${a},${s}`)&&(this.renderer.isOccupiedByTree(a,s)||(o.push(`${a},${s}`),r.push({c:a,r:s}),n[`${a},${s}`]=`${i.c},${i.r}`))}}if(s){let r=[`${e.c},${e.r}`];if(i=n[`${e.c},${e.r}`],!i)return!1;for(;i!==`${t.c},${t.r}`;)r.push(i),i=n[i];return r.reverse()}return!1}}class o{constructor(t,e){this.path=[],this.renderer=t,this.animationFrame=null,this.timerId=null,this.previous={},this.pathFinder=e,this.start={c:t.start.c,r:t.start.r}}addEvent(){this.renderer.get().addEventListener("click",t=>{window.cancelAnimationFrame(this.animationFrame),this.animationFrame=null,clearInterval(this.timerId);let e={c:this.renderer.getColFromX(t.clientX),r:this.renderer.getRowFromY(t.clientY)};if(this.renderer.clearBlocks(this.path),this.path=this.pathFinder.generatePath(this.start,e),!this.path)return;this.renderer.drawPath(this.path),this.previous={c:this.start.c,r:this.start.r};let i=()=>{let t=this.path.shift();if(!t)return void window.cancelAnimationFrame(this.animationFrame);this.renderer.context.clearRect(this.renderer.getXFromCol(this.previous.c)+1,this.renderer.getYFromRow(this.previous.r)+1,38,38);let e=t.split(",");this.start=this.previous={c:e[0],r:e[1]},this.renderer.clearBlock(this.previous.c,this.previous.r),this.renderer.drawPlayer(e[0],e[1]),this.path.length>0&&(this.timerId=setTimeout(()=>{window.requestAnimationFrame(i)},200))};this.animationFrame=window.requestAnimationFrame(i)})}}document.addEventListener("DOMContentLoaded",()=>{let t=new r(1401,641);t.drawGrid(),t.drawPlayer(t.start.c,t.start.r),t.drawTrees(100),new o(t,new s(t)).addEvent()})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3JlbmRlcmVyLmpzIiwid2VicGFjazovLy8uL3NyYy9wYXRoZmluZGVyLmpzIiwid2VicGFjazovLy8uL3NyYy9hbmltYXRpb24uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlJlbmRlcmVyIiwid2lkdGgiLCJoZWlnaHQiLCJ0aGlzIiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiY29udGV4dCIsImdldENvbnRleHQiLCJncmlkT3B0aW9ucyIsImNvbG9yIiwiZ3JpZFNpemUiLCJsaW5lc1NpemUiLCJvY2N1cGllZCIsInN0YXJ0IiwiZ2V0UmFuZG9tQ29sIiwiZ2V0UmFuZG9tUm93IiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhcHBlbmRDaGlsZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIngiLCJ5Iiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJwYXJzZUludCIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZSIsImltYWdlIiwib25sb2FkIiwiZHJhd0ltYWdlIiwiZ2V0WEZyb21Db2wiLCJnZXRZRnJvbVJvdyIsImdldEtleSIsInBhdGgiLCJsZW5ndGgiLCJzcGxpdCIsImJlZ2luUGF0aCIsImFyYyIsIlBJIiwiZmlsbFN0eWxlIiwiZmlsbCIsInVuZGVmaW5lZCIsInRyZWVzIiwiY2xlYXJSZWN0IiwicmVzIiwiY2xlYXJCbG9jayIsIlBhdGhGaW5kZXIiLCJyZW5kZXJlciIsInNvdXJjZSIsInRhcmdldCIsInEiLCJmb3VuZCIsInZpc2l0ZWQiLCJwYXRocyIsInNoaWZ0IiwiZHIiLCJkYyIsImNyIiwiY2MiLCJpbmRleE9mIiwiaXNPY2N1cGllZEJ5VHJlZSIsInB1c2giLCJyaWdodFBhdGgiLCJyZXZlcnNlIiwiQW5pbWF0aW9uIiwicGF0aEZpbmRlciIsImFuaW1hdGlvbkZyYW1lIiwidGltZXJJZCIsInByZXZpb3VzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ3aW5kb3ciLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsImNsZWFySW50ZXJ2YWwiLCJnZXRDb2xGcm9tWCIsImNsaWVudFgiLCJnZXRSb3dGcm9tWSIsImNsaWVudFkiLCJjbGVhckJsb2NrcyIsImdlbmVyYXRlUGF0aCIsImRyYXdQYXRoIiwiYW5pbWF0aW9uQ2FsbGJhY2siLCJjdXJyIiwiZHJhd1BsYXllciIsInNldFRpbWVvdXQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJkcmF3R3JpZCIsImRyYXdUcmVlcyIsImFkZEV2ZW50Il0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFBUEUsR0FBOEIsaUJBQVZGLEdBQXNCQSxHQUFTQSxFQUFNRyxXQUFZLE9BQU9ILEVBQ2hGLElBQUlJLEVBQUtYLE9BQU9ZLE9BQU8sTUFHdkIsR0FGQTFCLEVBQW9Ca0IsRUFBRU8sR0FDdEJYLE9BQU9DLGVBQWVVLEVBQUksVUFBVyxDQUFFVCxZQUFZLEVBQU1LLE1BQU9BLElBQ3RELEVBQVBFLEdBQTRCLGlCQUFURixFQUFtQixJQUFJLElBQUlNLEtBQU9OLEVBQU9yQixFQUFvQlUsRUFBRWUsRUFBSUUsRUFBSyxTQUFTQSxHQUFPLE9BQU9OLEVBQU1NLElBQVFDLEtBQUssS0FBTUQsSUFDOUksT0FBT0YsR0FJUnpCLEVBQW9CNkIsRUFBSSxTQUFTMUIsR0FDaEMsSUFBSVMsRUFBU1QsR0FBVUEsRUFBT3FCLFdBQzdCLFdBQXdCLE9BQU9yQixFQUFnQixTQUMvQyxXQUE4QixPQUFPQSxHQUV0QyxPQURBSCxFQUFvQlUsRUFBRUUsRUFBUSxJQUFLQSxHQUM1QkEsR0FJUlosRUFBb0JhLEVBQUksU0FBU2lCLEVBQVFDLEdBQVksT0FBT2pCLE9BQU9rQixVQUFVQyxlQUFlMUIsS0FBS3VCLEVBQVFDLElBR3pHL0IsRUFBb0JrQyxFQUFJLEdBSWpCbEMsRUFBb0JBLEVBQW9CbUMsRUFBSSxHLHNDQ2xGckQsTUFBTUMsRUFFTCxZQUFZQyxFQUFPQyxHQUNsQkMsS0FBS0YsTUFBUUEsRUFDYkUsS0FBS0QsT0FBU0EsRUFDZEMsS0FBS0MsT0FBU0MsU0FBU0MsY0FBYyxVQUNyQ0gsS0FBS0MsT0FBT0csYUFBYSxRQUFTTixHQUNsQ0UsS0FBS0MsT0FBT0csYUFBYSxTQUFVTCxHQUNuQ0MsS0FBS0ssUUFBVUwsS0FBS0MsT0FBT0ssV0FBVyxNQUN0Q04sS0FBS08sWUFBYyxDQUNsQkMsTUFBVyxPQUNYQyxTQUFXLEdBQ1hDLFVBQVcsR0FFWlYsS0FBS1csU0FBVyxHQUNoQlgsS0FBS1ksTUFBUSxDQUNaMUMsRUFBRzhCLEtBQUthLGVBQ1JsQyxFQUFHcUIsS0FBS2MsZ0JBR1RaLFNBQVNhLHFCQUFxQixRQUFRLEdBQUdDLFlBQVloQixLQUFLQyxRQUczRCxNQUNDLE9BQU9ELEtBQUtDLE9BR2IsZUFDQyxPQUFPZ0IsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWW5CLEtBQUtGLE1BQVFFLEtBQUtPLFlBQVlFLFdBR2xFLFlBQVlXLEdBQ1gsT0FBT0gsS0FBS0MsTUFBTUUsRUFBSXBCLEtBQUtPLFlBQVlFLFVBR3hDLFlBQVlZLEdBQ1gsT0FBT0osS0FBS0MsTUFBTUcsRUFBSXJCLEtBQUtPLFlBQVlFLFVBR3hDLGVBQ0MsT0FBT1EsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWW5CLEtBQUtELE9BQVNDLEtBQUtPLFlBQVlFLFdBR25FLFlBQVl2QyxHQUNYLE9BQU9BLEVBQUkrQyxLQUFLQyxNQUFPbEIsS0FBS0YsTUFBUUUsS0FBS08sWUFBWUUsVUFBYVQsS0FBS08sWUFBWUUsU0FHcEYsWUFBWTlCLEdBQ1gsT0FBT0EsRUFBSXNDLEtBQUtDLE1BQU9sQixLQUFLRixNQUFRRSxLQUFLTyxZQUFZRSxVQUFhVCxLQUFLTyxZQUFZRSxTQUdwRixXQUNDVCxLQUFLSyxRQUFRaUIsWUFBY3RCLEtBQUtPLFlBQVlDLE1BQzVDUixLQUFLSyxRQUFRa0IsVUFBWUMsU0FBU3hCLEtBQUtPLFlBQVlHLFdBQ25ELElBQUlELEVBQVdlLFNBQVN4QixLQUFLTyxZQUFZRSxVQUN6QyxJQUFLLElBQUk1QyxFQUFJLEVBQUdBLEVBQUltQyxLQUFLRCxPQUFRbEMsR0FBSzRDLEVBQ3JDVCxLQUFLSyxRQUFRb0IsT0FBTyxFQUFHNUQsR0FDdkJtQyxLQUFLSyxRQUFRcUIsT0FBTzFCLEtBQUtGLE1BQU9qQyxHQUNoQ21DLEtBQUtLLFFBQVFzQixTQUVkLElBQUssSUFBSTlELEVBQUksRUFBR0EsRUFBSW1DLEtBQUtGLE1BQU9qQyxHQUFLNEMsRUFDcENULEtBQUtLLFFBQVFvQixPQUFPNUQsRUFBRyxHQUN2Qm1DLEtBQUtLLFFBQVFxQixPQUFPN0QsRUFBR21DLEtBQUtELFFBQzVCQyxLQUFLSyxRQUFRc0IsU0FJZixXQUFXekQsRUFBR1MsR0FDYixJQUFJaUQsRUFBUTFCLFNBQVNDLGNBQWMsT0FDbkN5QixFQUFNeEIsYUFBYSxNQUFPLGtCQUMxQndCLEVBQU14QixhQUFhLEtBQU0sVUFFekJ3QixFQUFNQyxPQUFTLEtBQ2Q3QixLQUFLSyxRQUFReUIsVUFBVUYsRUFBTzVCLEtBQUsrQixZQUFZN0QsR0FBSThCLEtBQUtnQyxZQUFZckQsR0FBSXFCLEtBQUtPLFlBQVlFLFNBQVVULEtBQUtPLFlBQVlFLFdBR3JIVCxLQUFLVyxTQUFTWCxLQUFLaUMsT0FBTy9ELEVBQUdTLElBQU0sU0FHcEMsU0FBU3VELEdBQ1IsSUFBSSxJQUFJckUsRUFBSSxFQUFHQSxFQUFJcUUsRUFBS0MsT0FBUXRFLElBQU0sQ0FDckMsSUFBSUssRUFBR1MsR0FFTlQsRUFBR1MsR0FBS3VELEVBQUtyRSxHQUFHdUUsTUFBTSxLQUN2QnBDLEtBQUtLLFFBQVFnQyxZQUNickMsS0FBS0ssUUFBUWlDLElBQUl0QyxLQUFLK0IsWUFBWTdELEdBQUcsR0FBSThCLEtBQUtnQyxZQUFZckQsR0FBRyxHQUFJLEVBQUcsRUFBRyxFQUFJc0MsS0FBS3NCLElBQ2hGdkMsS0FBS0ssUUFBUW1DLFVBQVksTUFDekJ4QyxLQUFLSyxRQUFRb0MsT0FDYnpDLEtBQUtLLFFBQVFrQixVQUFZLEdBSTNCLE9BQU9yRCxFQUFHUyxHQUNULE1BQU8sR0FBR1QsS0FBS1MsSUFHaEIsaUJBQWlCVCxFQUFHUyxHQUNuQixZQUFPK0QsSUFBYzFDLEtBQUtXLFNBQVNYLEtBQUtpQyxPQUFPL0QsRUFBR1MsS0FBNEMsU0FBckNxQixLQUFLVyxTQUFTWCxLQUFLaUMsT0FBTy9ELEVBQUdTLElBR3ZGLFVBQVVnRSxHQUNULElBQUssSUFBSTlFLEVBQUksRUFBR0EsRUFBSThFLEVBQU85RSxJQUFLLENBQy9CLElBQUlLLEVBQUk4QixLQUFLYSxlQUNUbEMsRUFBSXFCLEtBQUtjLGVBRWIsUUFBSTRCLElBQWMxQyxLQUFLVyxTQUFTWCxLQUFLaUMsT0FBTy9ELEVBQUdTLElBQUssQ0FDbkRkLEdBQUssRUFDTCxTQUdELElBQUkrRCxFQUFRMUIsU0FBU0MsY0FBYyxPQUNuQ3lCLEVBQU14QixhQUFhLE1BQU8saUJBQzFCd0IsRUFBTXhCLGFBQWEsS0FBTSxRQUV6QndCLEVBQU1DLE9BQVMsS0FDZDdCLEtBQUtLLFFBQVF5QixVQUFVRixFQUFPNUIsS0FBSytCLFlBQVk3RCxHQUFLLEVBQUc4QixLQUFLZ0MsWUFBWXJELEdBQUssRUFBR3FCLEtBQUtPLFlBQVlFLFNBQVcsRUFBR1QsS0FBS08sWUFBWUUsU0FBVyxJQUc1SVQsS0FBS1csU0FBU1gsS0FBS2lDLE9BQU8vRCxFQUFHUyxJQUFNLFFBSXJDLFdBQVdULEVBQUdTLEdBQ2JxQixLQUFLSyxRQUFRdUMsVUFBVTVDLEtBQUsrQixZQUFZN0QsR0FBSyxFQUFHOEIsS0FBS2dDLFlBQVlyRCxHQUFLLEVBQUdxQixLQUFLTyxZQUFZRSxTQUFXLEVBQUdULEtBQUtPLFlBQVlFLFNBQVcsR0FHckksWUFBWXlCLEdBQ1gsSUFBSyxJQUFJckUsRUFBSSxFQUFHQSxFQUFJcUUsRUFBS0MsT0FBUXRFLElBQUssQ0FDckMsSUFBSWdGLEVBQU1YLEVBQUtyRSxHQUFHdUUsTUFBTSxLQUN4QnBDLEtBQUs4QyxXQUFXRCxFQUFJLEdBQUlBLEVBQUksTUNqSS9CLE1BQU1FLEVBRUwsWUFBYUMsR0FDWmhELEtBQUtnRCxTQUFXQSxFQUdqQixhQUFhQyxFQUFRQyxHQUNwQixJQUFJaEYsRUFBSSxDQUNQQSxFQUFHK0UsRUFBTy9FLEVBQ1ZTLEVBQUdzRSxFQUFPdEUsR0FHUHdFLEVBQUksQ0FBQ2pGLEdBQ0xrRixHQUFRLEVBQ1JDLEVBQVUsR0FDVkMsRUFBUSxHQUdaLElBRkFBLEVBQU0sR0FBR3BGLEVBQUVBLEtBQUtBLEVBQUVTLE1BQU8sRUFFbEJ3RSxFQUFFaEIsT0FBUyxHQUFHLENBRXBCakUsRUFBSWlGLEVBQUVJLFFBQ04sSUFBSUMsRUFBSyxFQUFFLEVBQUcsRUFBRyxFQUFHLEdBQ2hCQyxFQUFLLENBQUMsRUFBRyxHQUFJLEVBQUcsR0FFcEIsR0FBSVAsRUFBT2hGLEdBQUtBLEVBQUVBLEdBQUtnRixFQUFPdkUsR0FBS1QsRUFBRVMsRUFBRyxDQUN2Q3lFLEdBQVEsRUFDUixNQUdELElBQUssSUFBSXZGLEVBQUksRUFBR0EsRUFBSTJGLEVBQUdyQixPQUFRdEUsSUFBSyxDQUNuQyxJQUFJNkYsRUFBS2xDLFNBQVN0RCxFQUFFUyxHQUFLNkUsRUFBRzNGLEdBQ3hCOEYsRUFBS25DLFNBQVN0RCxFQUFFQSxHQUFLdUYsRUFBRzVGLEdBRXhCNkYsRUFBSyxHQUFLQyxFQUFLLEdBQUtELEVBQUt6QyxLQUFLQyxNQUFNbEIsS0FBS2dELFNBQVNqRCxPQUFTQyxLQUFLZ0QsU0FBU3pDLFlBQVlFLFVBQVksR0FBS2tELEVBQUsxQyxLQUFLQyxNQUFNbEIsS0FBS2dELFNBQVNsRCxNQUFRRSxLQUFLZ0QsU0FBU3pDLFlBQVlFLFVBQVksSUFJOUksSUFBcEM0QyxFQUFRTyxRQUFRLEdBQUdELEtBQU1ELE9BSXpCMUQsS0FBS2dELFNBQVNhLGlCQUFpQkYsRUFBSUQsS0FJdkNMLEVBQVFTLEtBQUssR0FBR0gsS0FBTUQsS0FDdEJQLEVBQUVXLEtBQUssQ0FBQzVGLEVBQUd5RixFQUFJaEYsRUFBRytFLElBQ2xCSixFQUFNLEdBQUdLLEtBQU1ELEtBQVEsR0FBR3hGLEVBQUVBLEtBQUtBLEVBQUVTLE9BSXJDLEdBQUl5RSxFQUFPLENBQ1YsSUFBSVcsRUFBWSxDQUFDLEdBQUdiLEVBQU9oRixLQUFLZ0YsRUFBT3ZFLEtBSXZDLEdBRkFULEVBQUlvRixFQUFNLEdBQUdKLEVBQU9oRixLQUFLZ0YsRUFBT3ZFLE1BRTVCVCxFQUNILE9BQU8sRUFHUixLQUFPQSxJQUFNLEdBQUcrRSxFQUFPL0UsS0FBSytFLEVBQU90RSxLQUNsQ29GLEVBQVVELEtBQUs1RixHQUNmQSxFQUFJb0YsRUFBTXBGLEdBR1gsT0FBTzZGLEVBQVVDLFVBRWpCLE9BQU8sR0NuRVYsTUFBTUMsRUFFTCxZQUFZakIsRUFBVWtCLEdBQ3JCbEUsS0FBS2tDLEtBQU8sR0FDWmxDLEtBQUtnRCxTQUFXQSxFQUNoQmhELEtBQUttRSxlQUFpQixLQUN0Qm5FLEtBQUtvRSxRQUFVLEtBQ2ZwRSxLQUFLcUUsU0FBVyxHQUNoQnJFLEtBQUtrRSxXQUFhQSxFQUNsQmxFLEtBQUtZLE1BQVEsQ0FDWixFQUFLb0MsRUFBU3BDLE1BQU0xQyxFQUNwQixFQUFLOEUsRUFBU3BDLE1BQU1qQyxHQUl0QixXQUNDcUIsS0FBS2dELFNBQVN0RSxNQUFNNEYsaUJBQWlCLFFBQVVDLElBQzlDQyxPQUFPQyxxQkFBcUJ6RSxLQUFLbUUsZ0JBQ2pDbkUsS0FBS21FLGVBQWlCLEtBQ3RCTyxjQUFjMUUsS0FBS29FLFNBRW5CLElBQUlsQixFQUFTLENBQ1poRixFQUFHOEIsS0FBS2dELFNBQVMyQixZQUFZSixFQUFFSyxTQUMvQmpHLEVBQUdxQixLQUFLZ0QsU0FBUzZCLFlBQVlOLEVBQUVPLFVBTWhDLEdBSEE5RSxLQUFLZ0QsU0FBUytCLFlBQVkvRSxLQUFLa0MsTUFDL0JsQyxLQUFLa0MsS0FBT2xDLEtBQUtrRSxXQUFXYyxhQUFhaEYsS0FBS1ksTUFBT3NDLElBRWhEbEQsS0FBS2tDLEtBQ1QsT0FHRGxDLEtBQUtnRCxTQUFTaUMsU0FBU2pGLEtBQUtrQyxNQUU1QmxDLEtBQUtxRSxTQUFXLENBQ2ZuRyxFQUFHOEIsS0FBS1ksTUFBTTFDLEVBQ2RTLEVBQUdxQixLQUFLWSxNQUFNakMsR0FHZixJQUFJdUcsRUFBb0IsS0FDdkIsSUFBSUMsRUFBT25GLEtBQUtrQyxLQUFLcUIsUUFFckIsSUFBSzRCLEVBRUosWUFEQVgsT0FBT0MscUJBQXFCekUsS0FBS21FLGdCQUlsQ25FLEtBQUtnRCxTQUFTM0MsUUFBUXVDLFVBQVU1QyxLQUFLZ0QsU0FBU2pCLFlBQVkvQixLQUFLcUUsU0FBU25HLEdBQUssRUFBRzhCLEtBQUtnRCxTQUFTaEIsWUFBWWhDLEtBQUtxRSxTQUFTMUYsR0FBSyxFQUFHLEdBQUksSUFDcEksSUFBSWtFLEVBQU1zQyxFQUFLL0MsTUFBTSxLQUNyQnBDLEtBQUtZLE1BQVFaLEtBQUtxRSxTQUFXLENBQzVCbkcsRUFBRzJFLEVBQUksR0FDUGxFLEVBQUdrRSxFQUFJLElBRVI3QyxLQUFLZ0QsU0FBU0YsV0FBVzlDLEtBQUtxRSxTQUFTbkcsRUFBRzhCLEtBQUtxRSxTQUFTMUYsR0FDeERxQixLQUFLZ0QsU0FBU29DLFdBQVd2QyxFQUFJLEdBQUlBLEVBQUksSUFFakM3QyxLQUFLa0MsS0FBS0MsT0FBUyxJQUN0Qm5DLEtBQUtvRSxRQUFVaUIsV0FBVyxLQUN6QmIsT0FBT2Msc0JBQXNCSixJQUMzQixPQUlMbEYsS0FBS21FLGVBQWlCSyxPQUFPYyxzQkFBc0JKLE1DNUR0RGhGLFNBQVNvRSxpQkFBaUIsbUJBQW9CLEtBQzdDLElBQUl0QixFQUFXLElBQUluRCxFQUFTLEtBQU0sS0FFbENtRCxFQUFTdUMsV0FDVHZDLEVBQVNvQyxXQUFXcEMsRUFBU3BDLE1BQU0xQyxFQUFHOEUsRUFBU3BDLE1BQU1qQyxHQUNyRHFFLEVBQVN3QyxVQUFVLEtBRUgsSUFBSXZCLEVBQVVqQixFQUFVLElBQUlELEVBQVdDLElBQzdDeUMiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiY2xhc3MgUmVuZGVyZXIge1xuXG5cdGNvbnN0cnVjdG9yKHdpZHRoLCBoZWlnaHQpIHtcblx0XHR0aGlzLndpZHRoID0gd2lkdGg7XG5cdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0dGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcblx0XHR0aGlzLmNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgd2lkdGgpO1xuXHRcdHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTtcblx0XHR0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG5cdFx0dGhpcy5ncmlkT3B0aW9ucyA9IHtcblx0XHRcdGNvbG9yOiAgICAgJ2dyZXknLFxuXHRcdFx0Z3JpZFNpemU6ICA0MCxcblx0XHRcdGxpbmVzU2l6ZTogMFxuXHRcdH07XG5cdFx0dGhpcy5vY2N1cGllZCA9IHt9O1xuXHRcdHRoaXMuc3RhcnQgPSB7XG5cdFx0XHRjOiB0aGlzLmdldFJhbmRvbUNvbCgpLFxuXHRcdFx0cjogdGhpcy5nZXRSYW5kb21Sb3coKSxcblx0XHR9O1xuXG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcyk7XG5cdH1cblxuXHRnZXQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY2FudmFzO1xuXHR9XG5cblx0Z2V0UmFuZG9tQ29sKCkge1xuXHRcdHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy53aWR0aCAvIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpKVxuXHR9XG5cblx0Z2V0Q29sRnJvbVgoeCkge1xuXHRcdHJldHVybiBNYXRoLmZsb29yKHggLyB0aGlzLmdyaWRPcHRpb25zLmdyaWRTaXplKTtcblx0fVxuXG5cdGdldFJvd0Zyb21ZKHkpIHtcblx0XHRyZXR1cm4gTWF0aC5mbG9vcih5IC8gdGhpcy5ncmlkT3B0aW9ucy5ncmlkU2l6ZSk7XG5cdH1cblxuXHRnZXRSYW5kb21Sb3coKSB7XG5cdFx0cmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLmhlaWdodCAvIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpKVxuXHR9XG5cblx0Z2V0WEZyb21Db2woYykge1xuXHRcdHJldHVybiBjICUgTWF0aC5mbG9vcigodGhpcy53aWR0aCAvIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpKSAqIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemVcblx0fVxuXG5cdGdldFlGcm9tUm93KHIpIHtcblx0XHRyZXR1cm4gciAlIE1hdGguZmxvb3IoKHRoaXMud2lkdGggLyB0aGlzLmdyaWRPcHRpb25zLmdyaWRTaXplKSkgKiB0aGlzLmdyaWRPcHRpb25zLmdyaWRTaXplXG5cdH1cblxuXHRkcmF3R3JpZCgpIHtcblx0XHR0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSB0aGlzLmdyaWRPcHRpb25zLmNvbG9yO1xuXHRcdHRoaXMuY29udGV4dC5saW5lV2lkdGggPSBwYXJzZUludCh0aGlzLmdyaWRPcHRpb25zLmxpbmVzU2l6ZSk7XG5cdFx0bGV0IGdyaWRTaXplID0gcGFyc2VJbnQodGhpcy5ncmlkT3B0aW9ucy5ncmlkU2l6ZSk7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmhlaWdodDsgaSArPSBncmlkU2l6ZSkge1xuXHRcdFx0dGhpcy5jb250ZXh0Lm1vdmVUbygwLCBpKTtcblx0XHRcdHRoaXMuY29udGV4dC5saW5lVG8odGhpcy53aWR0aCwgaSk7XG5cdFx0XHR0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG5cdFx0fVxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53aWR0aDsgaSArPSBncmlkU2l6ZSkge1xuXHRcdFx0dGhpcy5jb250ZXh0Lm1vdmVUbyhpLCAwKTtcblx0XHRcdHRoaXMuY29udGV4dC5saW5lVG8oaSwgdGhpcy5oZWlnaHQpO1xuXHRcdFx0dGhpcy5jb250ZXh0LnN0cm9rZSgpO1xuXHRcdH1cblx0fVxuXG5cdGRyYXdQbGF5ZXIoYywgcikge1xuXHRcdGxldCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRcdGltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2ltZy9wZXJzb24ucG5nJyk7XG5cdFx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdpZCcsICdwZXJzb24nKTtcblxuXHRcdGltYWdlLm9ubG9hZCA9ICgpID0+IHtcblx0XHRcdHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIHRoaXMuZ2V0WEZyb21Db2woYyksIHRoaXMuZ2V0WUZyb21Sb3cociksIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUsIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpO1xuXHRcdH07XG5cblx0XHR0aGlzLm9jY3VwaWVkW3RoaXMuZ2V0S2V5KGMsIHIpXSA9ICdwbGF5ZXInO1xuXHR9XG5cblx0ZHJhd1BhdGgocGF0aCkge1xuXHRcdGZvcihsZXQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSArKykge1xuXHRcdFx0bGV0IGMsIHI7XG5cblx0XHRcdFtjLCByXSA9IHBhdGhbaV0uc3BsaXQoJywnKTtcblx0XHRcdHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcblx0XHRcdHRoaXMuY29udGV4dC5hcmModGhpcy5nZXRYRnJvbUNvbChjKSsyMCwgdGhpcy5nZXRZRnJvbVJvdyhyKSsyMCwgNSwgMCwgMiAqIE1hdGguUEkpO1xuXHRcdFx0dGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9ICdyZWQnO1xuXHRcdFx0dGhpcy5jb250ZXh0LmZpbGwoKTtcblx0XHRcdHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAwO1xuXHRcdH1cblx0fVxuXG5cdGdldEtleShjLCByKSB7XG5cdFx0cmV0dXJuIGAke2N9LCR7cn1gO1xuXHR9XG5cblx0aXNPY2N1cGllZEJ5VHJlZShjLCByKSB7XG5cdFx0cmV0dXJuIHVuZGVmaW5lZCAhPT0gdGhpcy5vY2N1cGllZFt0aGlzLmdldEtleShjLCByKV0gJiYgdGhpcy5vY2N1cGllZFt0aGlzLmdldEtleShjLCByKV0gPT09ICd0cmVlJztcblx0fVxuXG5cdGRyYXdUcmVlcyh0cmVlcykge1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdHJlZXM7IGkrKykge1xuXHRcdFx0bGV0IGMgPSB0aGlzLmdldFJhbmRvbUNvbCgpO1xuXHRcdFx0bGV0IHIgPSB0aGlzLmdldFJhbmRvbVJvdygpO1xuXG5cdFx0XHRpZiAodW5kZWZpbmVkICE9PSB0aGlzLm9jY3VwaWVkW3RoaXMuZ2V0S2V5KGMsIHIpXSkge1xuXHRcdFx0XHRpIC09IDE7XG5cdFx0XHRcdGNvbnRpbnVlXG5cdFx0XHR9XG5cblx0XHRcdGxldCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRcdFx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmMnLCAnaW1nL3RyZWUuanBlZycpO1xuXHRcdFx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdpZCcsICd0cmVlJyk7XG5cblx0XHRcdGltYWdlLm9ubG9hZCA9ICgpID0+IHtcblx0XHRcdFx0dGhpcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgdGhpcy5nZXRYRnJvbUNvbChjKSArIDEsIHRoaXMuZ2V0WUZyb21Sb3cocikgKyAxLCB0aGlzLmdyaWRPcHRpb25zLmdyaWRTaXplIC0gMSwgdGhpcy5ncmlkT3B0aW9ucy5ncmlkU2l6ZSAtIDEpO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5vY2N1cGllZFt0aGlzLmdldEtleShjLCByKV0gPSAndHJlZSc7XG5cdFx0fVxuXHR9XG5cblx0Y2xlYXJCbG9jayhjLCByKSB7XG5cdFx0dGhpcy5jb250ZXh0LmNsZWFyUmVjdCh0aGlzLmdldFhGcm9tQ29sKGMpICsgMSwgdGhpcy5nZXRZRnJvbVJvdyhyKSArIDEsIHRoaXMuZ3JpZE9wdGlvbnMuZ3JpZFNpemUgLSAyLCB0aGlzLmdyaWRPcHRpb25zLmdyaWRTaXplIC0gMik7XG5cdH1cblxuXHRjbGVhckJsb2NrcyhwYXRoKSB7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgcmVzID0gcGF0aFtpXS5zcGxpdCgnLCcpO1xuXHRcdFx0dGhpcy5jbGVhckJsb2NrKHJlc1swXSwgcmVzWzFdKTtcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IHtSZW5kZXJlcn0iLCJjbGFzcyBQYXRoRmluZGVyIHtcblxuXHRjb25zdHJ1Y3RvciggcmVuZGVyZXIgKSB7XG5cdFx0dGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyXG5cdH1cblxuXHRnZW5lcmF0ZVBhdGgoc291cmNlLCB0YXJnZXQpIHtcblx0XHRsZXQgYyA9IHtcblx0XHRcdGM6IHNvdXJjZS5jLFxuXHRcdFx0cjogc291cmNlLnJcblx0XHR9O1xuXG5cdFx0bGV0IHEgPSBbY107XG5cdFx0bGV0IGZvdW5kID0gZmFsc2U7XG5cdFx0bGV0IHZpc2l0ZWQgPSBbXTtcblx0XHRsZXQgcGF0aHMgPSB7fTtcblx0XHRwYXRoc1tgJHtjLmN9LCR7Yy5yfWBdID0gZmFsc2U7XG5cblx0XHR3aGlsZSAocS5sZW5ndGggPiAwKSB7XG5cblx0XHRcdGMgPSBxLnNoaWZ0KCk7XG5cdFx0XHRsZXQgZHIgPSBbLTEsIDEsIDAsIDBdO1xuXHRcdFx0bGV0IGRjID0gWzAsIDAsIC0xLCAxXTtcblxuXHRcdFx0aWYgKHRhcmdldC5jID09IGMuYyAmJiB0YXJnZXQuciA9PSBjLnIpIHtcblx0XHRcdFx0Zm91bmQgPSB0cnVlO1xuXHRcdFx0XHRicmVha1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGRyLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGxldCBjciA9IHBhcnNlSW50KGMucikgKyBkcltpXTtcblx0XHRcdFx0bGV0IGNjID0gcGFyc2VJbnQoYy5jKSArIGRjW2ldO1xuXG5cdFx0XHRcdGlmIChjciA8IDAgfHwgY2MgPCAwIHx8IGNyID4gTWF0aC5mbG9vcih0aGlzLnJlbmRlcmVyLmhlaWdodCAvIHRoaXMucmVuZGVyZXIuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpIC0gMSB8fCBjYyA+IE1hdGguZmxvb3IodGhpcy5yZW5kZXJlci53aWR0aCAvIHRoaXMucmVuZGVyZXIuZ3JpZE9wdGlvbnMuZ3JpZFNpemUpIC0gMSkge1xuXHRcdFx0XHRcdGNvbnRpbnVlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmlzaXRlZC5pbmRleE9mKGAke2NjfSwke2NyfWApICE9PSAtMSkge1xuXHRcdFx0XHRcdGNvbnRpbnVlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGhpcy5yZW5kZXJlci5pc09jY3VwaWVkQnlUcmVlKGNjLCBjcikpIHtcblx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmlzaXRlZC5wdXNoKGAke2NjfSwke2NyfWApO1xuXHRcdFx0XHRxLnB1c2goe2M6IGNjLCByOiBjcn0pO1xuXHRcdFx0XHRwYXRoc1tgJHtjY30sJHtjcn1gXSA9IGAke2MuY30sJHtjLnJ9YFxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChmb3VuZCkge1xuXHRcdFx0bGV0IHJpZ2h0UGF0aCA9IFtgJHt0YXJnZXQuY30sJHt0YXJnZXQucn1gXTtcblxuXHRcdFx0YyA9IHBhdGhzW2Ake3RhcmdldC5jfSwke3RhcmdldC5yfWBdO1xuXG5cdFx0XHRpZighYykge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHRcdH1cblxuXHRcdFx0d2hpbGUgKGMgIT09IGAke3NvdXJjZS5jfSwke3NvdXJjZS5yfWApIHtcblx0XHRcdFx0cmlnaHRQYXRoLnB1c2goYyk7XG5cdFx0XHRcdGMgPSBwYXRoc1tjXVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcmlnaHRQYXRoLnJldmVyc2UoKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IHtQYXRoRmluZGVyfSIsImNsYXNzIEFuaW1hdGlvbiB7XG5cblx0Y29uc3RydWN0b3IocmVuZGVyZXIsIHBhdGhGaW5kZXIpIHtcblx0XHR0aGlzLnBhdGggPSBbXTtcblx0XHR0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG5cdFx0dGhpcy5hbmltYXRpb25GcmFtZSA9IG51bGw7XG5cdFx0dGhpcy50aW1lcklkID0gbnVsbDtcblx0XHR0aGlzLnByZXZpb3VzID0ge307XG5cdFx0dGhpcy5wYXRoRmluZGVyID0gcGF0aEZpbmRlcjtcblx0XHR0aGlzLnN0YXJ0ID0ge1xuXHRcdFx0J2MnOiByZW5kZXJlci5zdGFydC5jLFxuXHRcdFx0J3InOiByZW5kZXJlci5zdGFydC5yLFxuXHRcdH07XG5cdH1cblxuXHRhZGRFdmVudCgpIHtcblx0XHR0aGlzLnJlbmRlcmVyLmdldCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcblx0XHRcdHRoaXMuYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuXHRcdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVySWQpO1xuXG5cdFx0XHRsZXQgdGFyZ2V0ID0ge1xuXHRcdFx0XHRjOiB0aGlzLnJlbmRlcmVyLmdldENvbEZyb21YKGUuY2xpZW50WCksXG5cdFx0XHRcdHI6IHRoaXMucmVuZGVyZXIuZ2V0Um93RnJvbVkoZS5jbGllbnRZKVxuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5yZW5kZXJlci5jbGVhckJsb2Nrcyh0aGlzLnBhdGgpO1xuXHRcdFx0dGhpcy5wYXRoID0gdGhpcy5wYXRoRmluZGVyLmdlbmVyYXRlUGF0aCh0aGlzLnN0YXJ0LCB0YXJnZXQpO1xuXG5cdFx0XHRpZiAoIXRoaXMucGF0aCkge1xuXHRcdFx0XHRyZXR1cm5cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5yZW5kZXJlci5kcmF3UGF0aCh0aGlzLnBhdGgpO1xuXG5cdFx0XHR0aGlzLnByZXZpb3VzID0ge1xuXHRcdFx0XHRjOiB0aGlzLnN0YXJ0LmMsXG5cdFx0XHRcdHI6IHRoaXMuc3RhcnQuclxuXHRcdFx0fTtcblxuXHRcdFx0bGV0IGFuaW1hdGlvbkNhbGxiYWNrID0gKCkgPT4ge1xuXHRcdFx0XHRsZXQgY3VyciA9IHRoaXMucGF0aC5zaGlmdCgpO1xuXG5cdFx0XHRcdGlmICghY3Vycikge1xuXHRcdFx0XHRcdHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbkZyYW1lKTtcblx0XHRcdFx0XHRyZXR1cm5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMucmVuZGVyZXIuY29udGV4dC5jbGVhclJlY3QodGhpcy5yZW5kZXJlci5nZXRYRnJvbUNvbCh0aGlzLnByZXZpb3VzLmMpICsgMSwgdGhpcy5yZW5kZXJlci5nZXRZRnJvbVJvdyh0aGlzLnByZXZpb3VzLnIpICsgMSwgMzgsIDM4KTtcblx0XHRcdFx0bGV0IHJlcyA9IGN1cnIuc3BsaXQoJywnKTtcblx0XHRcdFx0dGhpcy5zdGFydCA9IHRoaXMucHJldmlvdXMgPSB7XG5cdFx0XHRcdFx0YzogcmVzWzBdLFxuXHRcdFx0XHRcdHI6IHJlc1sxXVxuXHRcdFx0XHR9O1xuXHRcdFx0XHR0aGlzLnJlbmRlcmVyLmNsZWFyQmxvY2sodGhpcy5wcmV2aW91cy5jLCB0aGlzLnByZXZpb3VzLnIpO1xuXHRcdFx0XHR0aGlzLnJlbmRlcmVyLmRyYXdQbGF5ZXIocmVzWzBdLCByZXNbMV0pO1xuXG5cdFx0XHRcdGlmICh0aGlzLnBhdGgubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdFx0d2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb25DYWxsYmFjayk7XG5cdFx0XHRcdFx0fSwgMjAwKVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLmFuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb25DYWxsYmFjayk7XG5cdFx0fSk7XG5cdH1cbn1cblxuZXhwb3J0IHtBbmltYXRpb259IiwiaW1wb3J0IHtSZW5kZXJlcn0gZnJvbSBcIi4vcmVuZGVyZXJcIjtcbmltcG9ydCB7UGF0aEZpbmRlcn0gZnJvbSBcIi4vcGF0aGZpbmRlclwiO1xuaW1wb3J0IHtBbmltYXRpb259IGZyb20gXCIuL2FuaW1hdGlvblwiO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuXHRsZXQgcmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoMTQwMSwgNjQxKTtcblxuXHRyZW5kZXJlci5kcmF3R3JpZCgpO1xuXHRyZW5kZXJlci5kcmF3UGxheWVyKHJlbmRlcmVyLnN0YXJ0LmMsIHJlbmRlcmVyLnN0YXJ0LnIpO1xuXHRyZW5kZXJlci5kcmF3VHJlZXMoMTAwKTtcblxuXHRsZXQgYW5pbWF0aW9uID0gbmV3IEFuaW1hdGlvbihyZW5kZXJlciwgbmV3IFBhdGhGaW5kZXIocmVuZGVyZXIpKTtcblx0YW5pbWF0aW9uLmFkZEV2ZW50KCk7XG59KTsiXSwic291cmNlUm9vdCI6IiJ9